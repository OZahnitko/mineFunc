name: Faker
on: push
jobs:
  # test:
  #   name: Test the application
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v2

  #     - name: Install dependencies
  #       run: npm install

  #     - name: Run test
  #       run: npm run test

  #     - name: Show the dir
  #       run: ls -la
  build:
    name: Build function
    runs-on: ubuntu-latest
    # needs: [test]
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install dependencies
        run: npm install

      - name: Build function
        run: npm run build

      - name: Copy package.json
        run: cp package.json ./build

      - name: Install production dependencies
        working-directory: ./build
        run: npm install --only=prod

      - name: Zip the function
        working-directory: ./build
        run: zip -r function.zip .

      - name: Archive function.zip
        uses: actions/upload-artifact@v2
        with:
          name: function.zip
          path: build/function.zip

      - name: Show content of the dir now
        working-directory: ./build
        run: ls -la
  deploy:
    name: Deploy function to AWS
    runs-on: ubuntu-latest
    needs: ["build"]
    steps:
      - name: Download function.zip
        uses: actions/download-artifact@v2
        with:
          name: function.zip

      - name: Show where the zip was downloaded
        run: ls -la

      - name: Unzip function.zip
        run: unzip function.zip

      - name: Show the result of the unzipping
        run: ls -la
